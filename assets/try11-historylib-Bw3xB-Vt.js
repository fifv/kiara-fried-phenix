import{__toESM as e,require_jsx_runtime as t,require_react as n}from"./index-BfF3hZ2k.js";import{_extends as r}from"./extends-CLHgL9Jj.js";var i;(function(e){e.Pop=`POP`,e.Push=`PUSH`,e.Replace=`REPLACE`})(i||={});var a=function(e){return e},o=`beforeunload`,s=`popstate`;function c(e){e===void 0&&(e={});var t=e,n=t.window,c=n===void 0?document.defaultView:n,d=c.history;function f(){var e=c.location,t=e.pathname,n=e.search,r=e.hash,i=d.state||{};return[i.idx,a({pathname:t,search:n,hash:r,state:i.usr||null,key:i.key||`default`})]}var p=null;function m(){if(p)b.call(p),p=null;else{var e=i.Pop,t=f(),n=t[0],r=t[1];if(b.length){if(n!=null){var a=_-n;a&&(p={action:e,location:r,retry:function(){O(a*-1)}},O(a))}}else T(e)}}c.addEventListener(s,m);var h=i.Pop,g=f(),_=g[0],v=g[1],y=u(),b=u();_??(_=0,d.replaceState(r({},d.state,{idx:_}),``));function x(e){return typeof e==`string`?e:te(e)}function S(e,t){return t===void 0&&(t=null),a(r({pathname:v.pathname,hash:``,search:``},typeof e==`string`?ne(e):e,{state:t,key:ee()}))}function C(e,t){return[{usr:e.state,key:e.key,idx:t},x(e)]}function w(e,t,n){return!b.length||(b.call({action:e,location:t,retry:n}),!1)}function T(e){h=e;var t=f();_=t[0],v=t[1],y.call({action:h,location:v})}function E(e,t){var n=i.Push,r=S(e,t);function a(){E(e,t)}if(w(n,r,a)){var o=C(r,_+1),s=o[0],l=o[1];try{d.pushState(s,``,l)}catch{c.location.assign(l)}T(n)}}function D(e,t){var n=i.Replace,r=S(e,t);function a(){D(e,t)}if(w(n,r,a)){var o=C(r,_),s=o[0],c=o[1];d.replaceState(s,``,c),T(n)}}function O(e){d.go(e)}var k={get action(){return h},get location(){return v},createHref:x,push:E,replace:D,go:O,back:function(){O(-1)},forward:function(){O(1)},listen:function(e){return y.push(e)},block:function(e){var t=b.push(e);return b.length===1&&c.addEventListener(o,l),function(){t(),b.length||c.removeEventListener(o,l)}}};return k}function l(e){e.preventDefault(),e.returnValue=``}function u(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter(function(e){return e!==t})}},call:function(t){e.forEach(function(e){return e&&e(t)})}}}function ee(){return Math.random().toString(36).substr(2,8)}function te(e){var t=e.pathname,n=t===void 0?`/`:t,r=e.search,i=r===void 0?``:r,a=e.hash,o=a===void 0?``:a;return i&&i!==`?`&&(n+=i.charAt(0)===`?`?i:`?`+i),o&&o!==`#`&&(n+=o.charAt(0)===`#`?o:`#`+o),n}function ne(e){var t={};if(e){var n=e.indexOf(`#`);n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));var r=e.indexOf(`?`);r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}var d=Symbol.for(`immer-nothing`),f=Symbol.for(`immer-draftable`),p=Symbol.for(`immer-state`);function m(e,...t){throw Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var h=Object.getPrototypeOf;function g(e){return!!e&&!!e[p]}function _(e){return e?y(e)||Array.isArray(e)||!!e[f]||!!e.constructor?.[f]||T(e)||E(e):!1}var v=Object.prototype.constructor.toString();function y(e){if(!e||typeof e!=`object`)return!1;let t=h(e);if(t===null)return!0;let n=Object.hasOwnProperty.call(t,`constructor`)&&t.constructor;return n===Object?!0:typeof n==`function`&&Function.toString.call(n)===v}function b(e,t){x(e)===0?Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)}):e.forEach((n,r)=>t(r,n,e))}function x(e){let t=e[p];return t?t.type_:Array.isArray(e)?1:T(e)?2:E(e)?3:0}function S(e,t){return x(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function C(e,t,n){let r=x(e);r===2?e.set(t,n):r===3?e.add(n):e[t]=n}function w(e,t){return e===t?e!==0||1/e==1/t:e!==e&&t!==t}function T(e){return e instanceof Map}function E(e){return e instanceof Set}function D(e){return e.copy_||e.base_}function O(e,t){if(T(e))return new Map(e);if(E(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);let n=y(e);if(t===!0||t===`class_only`&&!n){let t=Object.getOwnPropertyDescriptors(e);delete t[p];let n=Reflect.ownKeys(t);for(let r=0;r<n.length;r++){let i=n[r],a=t[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(h(e),t)}else{let t=h(e);if(t!==null&&n)return{...e};let r=Object.create(t);return Object.assign(r,e)}}function k(e,t=!1){return A(e)||g(e)||!_(e)?e:(x(e)>1&&(e.set=e.add=e.clear=e.delete=re),Object.freeze(e),t&&Object.entries(e).forEach(([e,t])=>k(t,!0)),e)}function re(){m(2)}function A(e){return Object.isFrozen(e)}var ie={};function j(e){let t=ie[e];return t||m(0,e),t}var M;function N(){return M}function ae(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function P(e,t){t&&(j(`Patches`),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function F(e){I(e),e.drafts_.forEach(oe),e.drafts_=null}function I(e){e===M&&(M=e.parent_)}function L(e){return M=ae(M,e)}function oe(e){let t=e[p];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function R(e,t){t.unfinalizedDrafts_=t.drafts_.length;let n=t.drafts_[0],r=e!==void 0&&e!==n;return r?(n[p].modified_&&(F(t),m(4)),_(e)&&(e=z(t,e),t.parent_||V(t,e)),t.patches_&&j(`Patches`).generateReplacementPatches_(n[p].base_,e,t.patches_,t.inversePatches_)):e=z(t,n,[]),F(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e===d?void 0:e}function z(e,t,n){if(A(t))return t;let r=t[p];if(!r)return b(t,(i,a)=>B(e,r,t,i,a,n)),t;if(r.scope_!==e)return t;if(!r.modified_)return V(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;let t=r.copy_,i=t,a=!1;r.type_===3&&(i=new Set(t),t.clear(),a=!0),b(i,(i,o)=>B(e,r,t,i,o,n,a)),V(e,t,!1),n&&e.patches_&&j(`Patches`).generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function B(e,t,n,r,i,a,o){if(g(i)){let o=a&&t&&t.type_!==3&&!S(t.assigned_,r)?a.concat(r):void 0,s=z(e,i,o);if(C(n,r,s),g(s))e.canAutoFreeze_=!1;else return}else o&&n.add(i);if(_(i)&&!A(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;z(e,i),(!t||!t.scope_.parent_)&&typeof r!=`symbol`&&Object.prototype.propertyIsEnumerable.call(n,r)&&V(e,i)}}function V(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&k(t,n)}function se(e,t){let n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:N(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},i=r,a=H;n&&(i=[r],a=U);let{revoke:o,proxy:s}=Proxy.revocable(i,a);return r.draft_=s,r.revoke_=o,s}var H={get(e,t){if(t===p)return e;let n=D(e);if(!S(n,t))return ce(e,n,t);let r=n[t];return e.finalized_||!_(r)?r:r===W(e.base_,t)?(q(e),e.copy_[t]=J(r,e)):r},has(e,t){return t in D(e)},ownKeys(e){return Reflect.ownKeys(D(e))},set(e,t,n){let r=G(D(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){let r=W(D(e),t),i=r?.[p];if(i&&i.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(w(n,r)&&(n!==void 0||S(e.base_,t)))return!0;q(e),K(e)}return e.copy_[t]===n&&(n!==void 0||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])?!0:(e.copy_[t]=n,e.assigned_[t]=!0,!0)},deleteProperty(e,t){return W(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,q(e),K(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){let n=D(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r&&{writable:!0,configurable:e.type_!==1||t!==`length`,enumerable:r.enumerable,value:n[t]}},defineProperty(){m(11)},getPrototypeOf(e){return h(e.base_)},setPrototypeOf(){m(12)}},U={};b(H,(e,t)=>{U[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),U.deleteProperty=function(e,t){return U.set.call(this,e,t,void 0)},U.set=function(e,t,n){return H.set.call(this,e[0],t,n,e[0])};function W(e,t){let n=e[p],r=n?D(n):e;return r[t]}function ce(e,t,n){let r=G(t,n);return r?`value`in r?r.value:r.get?.call(e.draft_):void 0}function G(e,t){if(!(t in e))return;let n=h(e);for(;n;){let e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=h(n)}}function K(e){e.modified_||(e.modified_=!0,e.parent_&&K(e.parent_))}function q(e){e.copy_||=O(e.base_,e.scope_.immer_.useStrictShallowCopy_)}var le=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{if(typeof e==`function`&&typeof t!=`function`){let n=t;t=e;let r=this;return function(e=n,...i){return r.produce(e,e=>t.call(this,e,...i))}}typeof t!=`function`&&m(6),n!==void 0&&typeof n!=`function`&&m(7);let r;if(_(e)){let i=L(this),a=J(e,void 0),o=!0;try{r=t(a),o=!1}finally{o?F(i):I(i)}return P(i,n),R(r,i)}else if(!e||typeof e!=`object`){if(r=t(e),r===void 0&&(r=e),r===d&&(r=void 0),this.autoFreeze_&&k(r,!0),n){let t=[],i=[];j(`Patches`).generateReplacementPatches_(e,r,t,i),n(t,i)}return r}else m(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e==`function`)return(t,...n)=>this.produceWithPatches(t,t=>e(t,...n));let n,r,i=this.produce(e,t,(e,t)=>{n=e,r=t});return[i,n,r]},typeof e?.autoFreeze==`boolean`&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy==`boolean`&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){_(e)||m(8),g(e)&&(e=ue(e));let t=L(this),n=J(e,void 0);return n[p].isManual_=!0,I(t),n}finishDraft(e,t){let n=e&&e[p];(!n||!n.isManual_)&&m(9);let{scope_:r}=n;return P(r,t),R(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){let r=t[n];if(r.path.length===0&&r.op===`replace`){e=r.value;break}}n>-1&&(t=t.slice(n+1));let r=j(`Patches`).applyPatches_;return g(e)?r(e,t):this.produce(e,e=>r(e,t))}};function J(e,t){let n=T(e)?j(`MapSet`).proxyMap_(e,t):E(e)?j(`MapSet`).proxySet_(e,t):se(e,t),r=t?t.scope_:N();return r.drafts_.push(n),n}function ue(e){return g(e)||m(10,e),Y(e)}function Y(e){if(!_(e)||A(e))return e;let t=e[p],n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=O(e,t.scope_.immer_.useStrictShallowCopy_)}else n=O(e,!0);return b(n,(e,t)=>{C(n,e,Y(t))}),t&&(t.finalized_=!1),n}var X=new le,de=X.produce,fe=X.produceWithPatches.bind(X),pe=X.setAutoFreeze.bind(X),me=X.setUseStrictShallowCopy.bind(X),he=X.applyPatches.bind(X),ge=X.createDraft.bind(X),_e=X.finishDraft.bind(X),Z=e(n(),1);function ve(e){var t=(0,Z.useState)(function(){return k(typeof e==`function`?e():e,!0)}),n=t[1];return[t[0],(0,Z.useCallback)(function(e){n(typeof e==`function`?de(e):k(e))},[])]}var Q=e(t());const $=c();function ye(){let[e,t]=(0,Z.useState)(0),[n,r]=ve([]);return(0,Z.useEffect)(()=>{let e=$.listen(({action:e,location:t})=>{let n=`The current URL is ${t.pathname}${t.search}${t.hash}`;console.log(n,`-----------`,`The last navigation action was ${e}`),console.log(t),r(r=>{let a={locationStr:n,state:t.state,location:t};switch(e){case i.Pop:r.pop();break;case i.Push:r.push(a);break;case i.Replace:r.length>0&&(r[r.length-1]=a);break;default:break}})});return()=>{e()}},[]),console.log(n),(0,Q.jsxs)(`div`,{children:[(0,Q.jsxs)(`button`,{onClick:()=>{$.push(`/${e}`,{count:e}),t(e=>e+1)},children:[`Push:`,e]}),(0,Q.jsxs)(`button`,{onClick:()=>{$.replace(`/${e}`,{count:e}),t(e=>e+1)},children:[`Replace:`,e]}),(0,Q.jsx)(`button`,{onClick:()=>{$.back(),t(e=>e+1)},children:`Back`}),(0,Q.jsx)(`button`,{onClick:()=>{$.forward(),t(e=>e+1)},children:`Forward`}),(0,Q.jsx)(`div`,{children:n.slice().reverse().map(e=>(0,Q.jsxs)(`div`,{children:[e.locationStr,`, state:  `,JSON.stringify(e.state)]},e.location.key))})]})}export{ye as default};