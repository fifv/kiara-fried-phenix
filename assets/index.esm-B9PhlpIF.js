import{__toESM as e,require_react as t}from"./index-BfF3hZ2k.js";const n=(e,t)=>e.unstable_is?e.unstable_is(t):t===e,r=e=>`init`in e,i=e=>!!e.write,a=e=>`v`in e||`e`in e,o=e=>{if(`e`in e)throw e.e;return e.v},s=new WeakMap,c=e=>{var t;return d(e)&&!!(t=s.get(e))?.[0]},l=e=>{let t=s.get(e);t?.[0]&&(t[0]=!1,t[1].forEach(e=>e()))},u=(e,t)=>{let n=s.get(e);if(!n){n=[!0,new Set],s.set(e,n);let t=()=>{n[0]=!1};e.then(t,t)}n[1].add(t)},d=e=>typeof e?.then==`function`,f=(e,t,n)=>{n.p.has(e)||(n.p.add(e),t.then(()=>{n.p.delete(e)},()=>{n.p.delete(e)}))},p=(e,t,n)=>{let r=n(e),i=`v`in r,a=r.v;if(d(t))for(let i of r.d.keys())f(e,t,n(i));r.v=t,delete r.e,(!i||!Object.is(a,r.v))&&(++r.n,d(a)&&l(a))},m=(e,t,n)=>{var r;let i=new Set;for(let t of(r=n.get(e))?.t||[])n.has(t)&&i.add(t);for(let e of t.p)i.add(e);return i},h=Symbol(),g=(e=new WeakMap,t=new WeakMap,s=new WeakMap,l=new Set,g=new Set,_=new Set,v={},y=(e,...t)=>e.read(...t),b=(e,...t)=>e.write(...t),x=(e,t)=>{var n;return(n=e.unstable_onInit)?.call(e,t)},S=(e,t)=>{var n;return(n=e.onMount)?.call(e,t)},...C)=>{let w=C[0]||(t=>{let n=e.get(t);return n||(n={d:new Map,p:new Set,n:0},e.set(t,n),x?.(t,P)),n}),T=C[1]||(()=>{let e=[],n=t=>{try{t()}catch(t){e.push(t)}};do{v.f&&n(v.f);let e=new Set,r=e.add.bind(e);l.forEach(e=>{var n;return(n=t.get(e))?.l.forEach(r)}),l.clear(),_.forEach(r),_.clear(),g.forEach(r),g.clear(),e.forEach(n),l.size&&E()}while(l.size||_.size||g.size);if(e.length)throw AggregateError(e)}),E=C[2]||(()=>{let e=[],n=new WeakSet,r=new WeakSet,i=Array.from(l);for(;i.length;){let a=i[i.length-1],o=w(a);if(r.has(a)){i.pop();continue}if(n.has(a)){s.get(a)===o.n&&e.push([a,o]),r.add(a),i.pop();continue}n.add(a);for(let e of m(a,o,t))n.has(e)||i.push(e)}for(let t=e.length-1;t>=0;--t){let[n,r]=e[t],i=!1;for(let e of r.d.keys())if(e!==n&&l.has(e)){i=!0;break}i&&(D(n),A(n)),s.delete(n)}}),D=C[3]||(e=>{var m;let h=w(e);if(a(h)&&(t.has(e)&&s.get(e)!==h.n||Array.from(h.d).every(([e,t])=>D(e).n===t)))return h;h.d.clear();let g=!0,_=()=>{t.has(e)&&(A(e),E(),T())},b=i=>{var s;if(n(e,i)){let e=w(i);if(!a(e))if(r(i))p(i,i.init,w);else throw Error(`no atom init`);return o(e)}let l=D(i);try{return o(l)}finally{h.d.set(i,l.n),c(h.v)&&f(e,h.v,l),(s=t.get(i))==null||s.t.add(e),g||_()}},x,S,C={get signal(){return x||=new AbortController,x.signal},get setSelf(){return!S&&i(e)&&(S=(...t)=>{if(!g)try{return k(e,...t)}finally{E(),T()}}),S}},O=h.n;try{let t=y(e,b,C);return p(e,t,w),d(t)&&(u(t,()=>x?.abort()),t.then(_,_)),h}catch(e){return delete h.v,h.e=e,++h.n,h}finally{g=!1,O!==h.n&&s.get(e)===O&&(s.set(e,h.n),l.add(e),(m=v.c)==null||m.call(v,e))}}),O=C[4]||(e=>{let n=[e];for(;n.length;){let e=n.pop(),r=w(e);for(let i of m(e,r,t)){let e=w(i);s.set(i,e.n),n.push(i)}}}),k=C[5]||((e,...t)=>{let i=!0,a=e=>o(D(e)),s=(t,...a)=>{var o;let s=w(t);try{if(n(e,t)){if(!r(t))throw Error(`atom not writable`);let e=s.n,n=a[0];p(t,n,w),A(t),e!==s.n&&(l.add(t),(o=v.c)==null||o.call(v,t),O(t));return}else return k(t,...a)}finally{i||(E(),T())}};try{return b(e,a,s,...t)}finally{i=!1}}),A=C[6]||(e=>{var n;let r=w(e),i=t.get(e);if(i&&!c(r.v)){for(let[t,a]of r.d)if(!i.d.has(t)){let r=w(t),o=j(t);o.t.add(e),i.d.add(t),a!==r.n&&(l.add(t),(n=v.c)==null||n.call(v,t),O(t))}for(let t of i.d||[])if(!r.d.has(t)){i.d.delete(t);let n=M(t);n?.t.delete(e)}}}),j=C[7]||(e=>{var n;let r=w(e),a=t.get(e);if(!a){D(e);for(let t of r.d.keys()){let n=j(t);n.t.add(e)}if(a={l:new Set,d:new Set(r.d.keys()),t:new Set},t.set(e,a),(n=v.m)==null||n.call(v,e),i(e)){let t=()=>{let t=!0,n=(...n)=>{try{return k(e,...n)}finally{t||(E(),T())}};try{let r=S(e,n);r&&(a.u=()=>{t=!0;try{r()}finally{t=!1}})}finally{t=!1}};g.add(t)}}return a}),M=C[8]||(e=>{var n;let r=w(e),i=t.get(e);if(i&&!i.l.size&&!Array.from(i.t).some(n=>{var r;return(r=t.get(n))?.d.has(e)})){i.u&&_.add(i.u),i=void 0,t.delete(e),(n=v.u)==null||n.call(v,e);for(let t of r.d.keys()){let n=M(t);n?.t.delete(e)}return}return i}),N=[e,t,s,l,g,_,v,y,b,x,S,w,T,E,D,O,k,A,j,M],P={get:e=>o(D(e)),set:(e,...t)=>{try{return k(e,...t)}finally{E(),T()}},sub:(e,t)=>{let n=j(e),r=n.l;return r.add(t),T(),()=>{r.delete(t),M(e),T()}}};return Object.defineProperty(P,h,{value:N}),P},_=g,v=u;let y=0;function b(e,t){let n=`atom${++y}`,r={toString(){return n}};return typeof e==`function`?r.read=e:(r.init=e,r.read=x,r.write=S),t&&(r.write=t),r}function x(e){return e(this)}function S(e,t,n){return t(this,typeof n==`function`?n(e(this)):n)}let C;function w(){return C?C():_()}let T;function E(){return T||=w(),T}var D=e(t(),1);const O=(0,D.createContext)(void 0);function k(e){let t=(0,D.useContext)(O);return e?.store||t||E()}const A=e=>typeof e?.then==`function`,j=e=>{e.status||(e.status=`pending`,e.then(t=>{e.status=`fulfilled`,e.value=t},t=>{e.status=`rejected`,e.reason=t}))},M=D.use||(e=>{if(e.status===`pending`)throw e;if(e.status===`fulfilled`)return e.value;throw e.status===`rejected`?e.reason:(j(e),e)}),N=new WeakMap,P=(e,t)=>{let n=N.get(e);return n||(n=new Promise((r,i)=>{let a=e,o=e=>t=>{a===e&&r(t)},s=e=>t=>{a===e&&i(t)},c=()=>{try{let e=t();A(e)?(N.set(e,n),a=e,e.then(o(e),s(e)),v(e,c)):r(e)}catch(e){i(e)}};e.then(o(e),s(e)),v(e,c)}),N.set(e,n)),n};function F(e,t){let{delay:n,unstable_promiseStatus:r=!D.use}=t||{},i=k(t),[[a,o,s],c]=(0,D.useReducer)(t=>{let n=i.get(e);return Object.is(t[0],n)&&t[1]===i&&t[2]===e?t:[n,i,e]},void 0,()=>[i.get(e),i,e]),l=a;if((o!==i||s!==e)&&(c(),l=i.get(e)),(0,D.useEffect)(()=>{let t=i.sub(e,()=>{if(r)try{let t=i.get(e);A(t)&&j(P(t,()=>i.get(e)))}catch{}if(typeof n==`number`){setTimeout(c,n);return}c()});return c(),t},[i,e,n,r]),(0,D.useDebugValue)(l),A(l)){let t=P(l,()=>i.get(e));return r&&j(t),M(t)}return l}function I(e,t){let n=k(t),r=(0,D.useCallback)((...t)=>n.set(e,...t),[n,e]);return r}function L(e,t){return[F(e,t),I(e,t)]}var R=()=>null;export{R as DevTools,b as atom,L as useAtom,I as useSetAtom};